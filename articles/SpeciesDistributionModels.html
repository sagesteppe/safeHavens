<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Species Distribution Models • safeHavens</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Species Distribution Models">
<meta name="description" content="Creating and understanding the Species Distribution Model required for EnvironmentalBasedSample.">
<meta property="og:description" content="Creating and understanding the Species Distribution Model required for EnvironmentalBasedSample.">
<meta property="og:image" content="https://sagesteppe.github.io/safeHavens/logo.png">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">safeHavens</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item"><a class="nav-link" href="../articles/index.html">Articles</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Species Distribution Models</h1>
            
      

      <div class="d-none name"><code>SpeciesDistributionModels.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">remotes</span><span class="fu">::</span><span class="fu">install_github</span><span class="op">(</span><span class="st">'sagesteppe/safeHavens'</span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="species-distribution-modelling">Species Distribution Modelling<a class="anchor" aria-label="anchor" href="#species-distribution-modelling"></a>
</h2>
<div class="section level3">
<h3 id="background">Background<a class="anchor" aria-label="anchor" href="#background"></a>
</h3>
<p>This vignette details the steps required to create a Species
Distribution Model (SDM) using the functions provided in
<code>safeHavens</code>. The SDM is required to use the
<code>EnvironmentalBasedSample</code> function, which is the most
complex sampling scheme provided in the package. The SDM is created
using an elastic net generalized linear model implemented via the
<code>glmnet</code> package. The SDM is then post-processed to create a
binary raster map of suitable and unsuitable habitat, that is used to
rescale the environmental predictor variables according to their
contributions to the model. These rescaled variables are then used in a
clustering algorithm to partition the species range into environmentally
distinct regions for germplasm sampling.</p>
<p>The goal of most SDM’s is to create a model that accurately predicts
where a species will be located in environmental space and can then be
predicted in geographic space. The goal of these models is to understand
the degree and direction to which various environmental features
correlate with a species observed range. This model is not intended to
replace a well-structured and thought-out SDM; rather, it is intended to
provide a quick model that can be used to inform sampling
strategies.</p>
</div>
<div class="section level3">
<h3 id="about">About<a class="anchor" aria-label="anchor" href="#about"></a>
</h3>
<p>While the authors are prone to creating many ‘advanced’ SDMs models
and in-house pipelines for developing them, we think that the juice is
not worth the squeeze and rely on a few powerhouse R packages to do the
heavy lifting. The main packages used are <code>dismo</code>,
<code>caret</code>, <code>glmnet</code>, <code>CAST</code>, and
<code>terra</code>. The <code>dismo</code> package provides a
user-friendly interface for working with species occurrence and raster
data, as well as some helper functions for thresholding and evaluating
models. The <code>caret</code> package provides a nice interface for
working with machine learning models, and the <code>glmnet</code>
package provides the elastic net model. The <code>CAST</code> package
provides functions for spatially informed cross-validation, which is
important for SDMs. The <code>terra</code> package provides functions
for working with raster data. All of these packages are well documented,
and maintained.</p>
</div>
</div>
<div class="section level2">
<h2 id="steps-to-create-an-sdm">Steps to create an SDM<a class="anchor" aria-label="anchor" href="#steps-to-create-an-sdm"></a>
</h2>
<div class="section level4">
<h4 id="prep-data">prep data<a class="anchor" aria-label="anchor" href="#prep-data"></a>
</h4>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://sagesteppe.github.io/safeHavens/">safeHavens</a></span><span class="op">)</span></span></code></pre></div>
<p>First you will need georeference occurrence data for your species of
interest. For common species we recommened the <code>rgbif</code>
package to download occurrence data from GBIF.</p>
<p>Here to maintain a smaller package size, and integrate with the
tutorial in <code>dismo</code> we use a built in data set for
<em>Bradypus variegatus</em> (Brown-throated sloth). We do this to also
leverage the raster data provided in <code>dismo</code> as well.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span>package<span class="op">=</span><span class="st">"dismo"</span><span class="op">)</span>, <span class="st">'ex'</span>, <span class="st">'bradypus.csv'</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="va">x</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'lon'</span>, <span class="st">'lat'</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html" class="external-link">st_as_sf</a></span><span class="op">(</span><span class="va">x</span>, coords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'lon'</span>, <span class="st">'lat'</span><span class="op">)</span>, crs <span class="op">=</span> <span class="fl">4326</span><span class="op">)</span></span>
<span></span>
<span><span class="va">planar_proj</span> <span class="op">&lt;-</span> <span class="fl">3857</span> <span class="co"># Web Mercator for planar distance calcs</span></span>
<span></span>
<span><span class="va">files</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files</a></span><span class="op">(</span></span>
<span>  path <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span>package<span class="op">=</span><span class="st">"dismo"</span><span class="op">)</span>, <span class="st">'ex'</span><span class="op">)</span>, </span>
<span>  pattern <span class="op">=</span> <span class="st">'grd'</span>,  full.names<span class="op">=</span><span class="cn">TRUE</span> <span class="op">)</span></span>
<span><span class="va">predictors</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/rast.html" class="external-link">rast</a></span><span class="op">(</span><span class="va">files</span><span class="op">)</span> <span class="co"># import the independent variables</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="fit-the-model">fit the model<a class="anchor" aria-label="anchor" href="#fit-the-model"></a>
</h3>
<p>Here we fit as SDM using <code>elasticSDM</code>. For arguments it
requires occurrence data <code>x</code>, a raster stack of
<code>predictors</code>, a <code>quantile_v</code> that is an offset
used to create pseudo-absence data, and a <code>planar_proj</code> used
to calculate distances between occurrence data and possible
pseudo-absence points. The <code>quantile_v</code> is used to create
pseudo-absence data by calculating the distance from each occurrence
point to the nearest neighbor, and then selecting a quantile of these
distances to create a buffer around each occurrence point. Points
outside of this buffer are used pseudo-absences.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sdModel</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/elasticSDM.html">elasticSDM</a></span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="va">x</span>,</span>
<span>  predictors <span class="op">=</span> <span class="va">predictors</span>,</span>
<span>  quantile_v <span class="op">=</span> <span class="fl">0.025</span>,</span>
<span>  planar_proj <span class="op">=</span> <span class="va">planar_proj</span></span>
<span>  <span class="op">)</span></span>
<span><span class="co">#&gt; Warning: </span></span>
<span><span class="co">#&gt; Grid searches over lambda (nugget and sill variances) with  minima at the endpoints: </span></span>
<span><span class="co">#&gt;   (GCV) Generalized Cross-Validation </span></span>
<span><span class="co">#&gt;    minimum at  right endpoint  lambda  =  1.656291e-07 (eff. df= 174.8 )</span></span></code></pre></div>
<p>Under the hood this function uses <code>caret</code> to help out with
<code>glmnet</code>, as it provides output which is very easy to explore
and interact with. Elastic net modelS bridge the world of lasso and
ridge regression by blending the alpha parameter. Lasso has an alpha of
0, while Ridge has an alpha of 1. Lasso regression will perform
automated variable selection, and can drop (or ‘shrink’) features from a
model, whereas Ridge will keep all variables and if correlated features
exist split contributions between them. An elastic net blends this
propensity to drop or retain variables whenever it is used.
<code>caret</code> will test a range of alphas to determine how much
ridge or lasso regression characteristics are best for the data at
hand.</p>
<p>MAKE A NOTE ABOUT THE PCNM MORAN EIGNENVECTORS HERE TOO.</p>
<div class="section level4">
<h4 id="explore-the-output">explore the output<a class="anchor" aria-label="anchor" href="#explore-the-output"></a>
</h4>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sdModel</span><span class="op">$</span><span class="va">CVStructure</span></span>
<span><span class="co">#&gt; glmnet </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; 184 samples</span></span>
<span><span class="co">#&gt;   6 predictor</span></span>
<span><span class="co">#&gt;   2 classes: '0', '1' </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; No pre-processing</span></span>
<span><span class="co">#&gt; Resampling: Bootstrapped (25 reps) </span></span>
<span><span class="co">#&gt; Summary of sample sizes: 184, 184, 184, 184, 184, 184, ... </span></span>
<span><span class="co">#&gt; Resampling results across tuning parameters:</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;   alpha  lambda        Accuracy   Kappa    </span></span>
<span><span class="co">#&gt;   0.10   0.0006204077  0.8360016  0.6712790</span></span>
<span><span class="co">#&gt;   0.10   0.0062040769  0.8282214  0.6560044</span></span>
<span><span class="co">#&gt;   0.10   0.0620407692  0.8279379  0.6559269</span></span>
<span><span class="co">#&gt;   0.55   0.0006204077  0.8365349  0.6722483</span></span>
<span><span class="co">#&gt;   0.55   0.0062040769  0.8287096  0.6571131</span></span>
<span><span class="co">#&gt;   0.55   0.0620407692  0.8182452  0.6371623</span></span>
<span><span class="co">#&gt;   1.00   0.0006204077  0.8376016  0.6743248</span></span>
<span><span class="co">#&gt;   1.00   0.0062040769  0.8293442  0.6582937</span></span>
<span><span class="co">#&gt;   1.00   0.0620407692  0.8107098  0.6222415</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Accuracy was used to select the optimal model using the largest value.</span></span>
<span><span class="co">#&gt; The final values used for the model were alpha = 1 and lambda = 0.0006204077.</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">sdModel</span><span class="op">$</span><span class="va">Model</span>, s <span class="op">=</span> <span class="st">"lambda.min"</span><span class="op">)</span></span>
<span><span class="co">#&gt; 7 x 1 sparse Matrix of class "dgCMatrix"</span></span>
<span><span class="co">#&gt;              s=lambda.min</span></span>
<span><span class="co">#&gt; (Intercept)  -4.138796551</span></span>
<span><span class="co">#&gt; bio17        -0.007649011</span></span>
<span><span class="co">#&gt; biome        -0.176893842</span></span>
<span><span class="co">#&gt; bio1          0.023751253</span></span>
<span><span class="co">#&gt; bio8         -0.005606085</span></span>
<span><span class="co">#&gt; bio12         0.001275749</span></span>
<span><span class="co">#&gt; PCNM1       -18.787653011</span></span></code></pre></div>
<p>Here we can see how the elastic net decided that is the top model. We
used Accuracy rather than Kappa as the main criterion for model
selection.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sdModel</span><span class="op">$</span><span class="va">ConfusionMatrix</span></span>
<span><span class="co">#&gt; Confusion Matrix and Statistics</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;           Reference</span></span>
<span><span class="co">#&gt; Prediction  0  1</span></span>
<span><span class="co">#&gt;          0 16  0</span></span>
<span><span class="co">#&gt;          1  7 22</span></span>
<span><span class="co">#&gt;                                           </span></span>
<span><span class="co">#&gt;                Accuracy : 0.8444          </span></span>
<span><span class="co">#&gt;                  95% CI : (0.7054, 0.9351)</span></span>
<span><span class="co">#&gt;     No Information Rate : 0.5111          </span></span>
<span><span class="co">#&gt;     P-Value [Acc &gt; NIR] : 3.102e-06       </span></span>
<span><span class="co">#&gt;                                           </span></span>
<span><span class="co">#&gt;                   Kappa : 0.6909          </span></span>
<span><span class="co">#&gt;                                           </span></span>
<span><span class="co">#&gt;  Mcnemar's Test P-Value : 0.02334         </span></span>
<span><span class="co">#&gt;                                           </span></span>
<span><span class="co">#&gt;             Sensitivity : 1.0000          </span></span>
<span><span class="co">#&gt;             Specificity : 0.6957          </span></span>
<span><span class="co">#&gt;          Pos Pred Value : 0.7586          </span></span>
<span><span class="co">#&gt;          Neg Pred Value : 1.0000          </span></span>
<span><span class="co">#&gt;              Prevalence : 0.4889          </span></span>
<span><span class="co">#&gt;          Detection Rate : 0.4889          </span></span>
<span><span class="co">#&gt;    Detection Prevalence : 0.6444          </span></span>
<span><span class="co">#&gt;       Balanced Accuracy : 0.8478          </span></span>
<span><span class="co">#&gt;                                           </span></span>
<span><span class="co">#&gt;        'Positive' Class : 1               </span></span>
<span><span class="co">#&gt; </span></span></code></pre></div>
<p>Here we can see how our selected model works on predicting the state
of test data. Note these accuracy results are slightly higher than those
from the CV folds. This is not a bug, CV folds are testing on their own
holdouts, while this is a brand new set of holdouts. The main reason the
confusion matrix results are likely to be higher is due to spatial
auto-correlation which are not address in a typical ‘random split’ of
test and train data. In order to minimize the effects of
spatial-autocorrelation on our model we use <code>CAST</code> under the
hood which allows for spatially informed cross validation.</p>
<p>Consider the output from CVStructure to be a bit more realistic.</p>
</div>
<div class="section level4">
<h4 id="binarize-the-output">binarize the output<a class="anchor" aria-label="anchor" href="#binarize-the-output"></a>
</h4>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">sdModel</span><span class="op">$</span><span class="va">RasterPredictions</span><span class="op">)</span></span></code></pre></div>
<p><img src="SpeciesDistributionModels_files/figure-html/Explore%20SDM%20output%20-%20Map%20of%20Predictions-1.png" class="r-plt" width="700"></p>
<p>SDM’s produce continuous surfaces displaying the predicted
probability of suitable habitat across a landscape. However binary
surfaes (Yes/No Suitable), i.e. <em>is it more or less probable that
suitable habitat for this taxon exists in this particular location (grid
cell)?</em> are often required from them; the function
<code>PostProcessSDM</code> is used to binarize the predictions.</p>
<p>Going from a continuous surface to a binary surface loses
information. The goal of the binary surface is to understand where the
species is likely to be found, and then sample germplasm from these
areas. There are many ways to threshold a SDM, and many caveats
associated with this process; Frank Harrell has written on the topic of
post-processing in statistics.</p>
<p>Historically, when assessing probability output 0.5 probability was
used as a threshold, probabilities beneath it considered ‘Not Suitable /
No’, while probabilities above are classified as ‘Suitable / Yes’. This
works for some cases, but thresholding is outside the domain of
statistics and in the realm of practice. My motto for implementing
models, is a slight elaboration of George Box’s aphorism, “<em>All
models are wrong, some are useful - how do you want to be wrong?</em>”.
Our goal of sampling for germplasm conservation is to maximize the
representation of allelic diversity across the range of a species. To
achieve this, we need an understanding of the species actual range,
hence it is better to predict the species present where it is not, than
to predict it absent where it actually grows. Accordingly, my default
thresholding statistic is <em>Sensitivity</em>. However, our function
supports all threshold options in <code><a href="https://rdrr.io/pkg/dismo/man/threshold.html" class="external-link">dismo::threshold</a></code>.</p>
<p>You may be wondering why this function is named
<code>PostProcessSDM</code> rather <code>ThresholdSDM</code>, the reason
for this discontinuity is that the function performs additional
processes after thresholding. Geographic buffers are created around the
intitial occurence points to ensure that none of the known occurrence
points are ‘missing’ from the output binary map. This is a two edged
sword, where we are again address the notion of dispersal limitation,
and realize that not all suitable habitat is occupied habitat.</p>
<p>What the <code>PostProcessSDM</code> function does is it again
creates cross validation folds, and selects all of our training data. In
each fold if then calculates the distance from each occurrence point to
it’s nearest neighbor. We then summarize these distances and can
understand the distribution of distances as a quantile. We use a
selected quantile, to then serve as a buffer. Area with predicted
suitable habitat outside of this buffer become ‘cut off’ (or masked)
from the binary raster map, and areas within buffer distance from known
occurrences which are currently masked are reassigned as probabilities.
The theory behind this process in underdeveloped and nascent, it does
come down to the gut of an analyst. With the <em>Bradypus</em> data set
I use 0.25 as the quantile, which is saying “Neighbors are generally
100km apart, I am happy with the risk of saying that 25km within each
occurrence is <em>occupied</em> suitable habitat”. Increasing this value
to say 1.0 will mean that no suitable habitat is removed, decreasing it
makes maps more conservative. The cost with increasing the distances
greatly is that the sampling methods may then puts grids in many areas
without populations to collect from.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">threshold_rasts</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/PostProcessSDM.html">PostProcessSDM</a></span><span class="op">(</span></span>
<span>  rast_cont <span class="op">=</span> <span class="va">sdModel</span><span class="op">$</span><span class="va">RasterPredictions</span>, </span>
<span>  test <span class="op">=</span> <span class="va">sdModel</span><span class="op">$</span><span class="va">TestData</span>,</span>
<span>  planar_proj <span class="op">=</span> <span class="va">planar_proj</span>,</span>
<span>  thresh_metric <span class="op">=</span> <span class="st">'sensitivity'</span>, </span>
<span>  quant_amt <span class="op">=</span> <span class="fl">0.5</span></span>
<span>  <span class="op">)</span></span>
<span><span class="co">#&gt; 1000 prediction points are sampled from the modeldomain</span></span></code></pre></div>
<p>We can compare the results of applying this function side by side
using the output from the function.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">threshold_rasts</span><span class="op">$</span><span class="va">FinalRasters</span><span class="op">)</span></span></code></pre></div>
<p><img src="SpeciesDistributionModels_files/figure-html/Compare%20Threshold%20Results-1.png" class="r-plt" width="700"></p>
</div>
<div class="section level4">
<h4 id="rescale-predictor-variables">rescale predictor variables<a class="anchor" aria-label="anchor" href="#rescale-predictor-variables"></a>
</h4>
<p><code>glmnet</code> is used for three main reasons, 1) it gives
directional coefficients and documents how each 1 unit increase in an
independent variable varies the response. 2) It maintains automated
feature selection reducing the work an analyst needs to do. 3)
<code>glmnet</code> re-scales all variables before model generation
combined with beta-coefficients allows for partitioning environmental
space into regions that are environmentally similar <em>for the
individual species</em>.</p>
<p>In this way our raster stack becomes representative of our model, we
can then use these values as the basis for hierarchical cluster later
on.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># CREATE A COPY OF THE RASTER PREDICTORS WHERE WE HAVE </span></span>
<span><span class="co"># STANDARDIZED EACH VARIABLE - SO IT IS EQUIVALENT TO THE INPUT TO THE GLMNET</span></span>
<span><span class="co"># FUNCTION, AND THEN MULTIPLIED IT BY IT'S BETA COEFFICIENT FROM THE FIT MODEL</span></span>
<span><span class="co"># we will also write out the beta coefficients using writeSDMresults right after</span></span>
<span><span class="co"># this. </span></span>
<span></span>
<span><span class="va">rr</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/RescaleRasters.html">RescaleRasters</a></span><span class="op">(</span></span>
<span>  model <span class="op">=</span> <span class="va">sdModel</span><span class="op">$</span><span class="va">Model</span>,</span>
<span>  predictors <span class="op">=</span> <span class="va">sdModel</span><span class="op">$</span><span class="va">Predictors</span>, </span>
<span>  training_data <span class="op">=</span> <span class="va">sdModel</span><span class="op">$</span><span class="va">TrainData</span>, </span>
<span>  pred_mat <span class="op">=</span> <span class="va">sdModel</span><span class="op">$</span><span class="va">PredictMatrix</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">rr</span><span class="op">$</span><span class="va">RescaledPredictors</span><span class="op">)</span></span></code></pre></div>
<p><img src="SpeciesDistributionModels_files/figure-html/Rescale%20Predictor%20Variables-1.png" class="r-plt" width="700"></p>
<p>We can see that the variables are ‘close’ to being on the same scale,
this will work in a clustering algorithm. If any of the layers are all
the same color (maybe yellow?) that means they have no variance, that’s
a term that was shrunk from the model. It will be dealt with internally
in a future function. The scales of the variables are not exact, because
they are weighed by their coefficients in the model</p>
<p><code>{r Show beta Coefficients from model print(rr$BetaCoefficients)</code></p>
<p>We can also look at the coefficients for each variable.
<code>glmnet</code> returns the ‘untransformed’ variables, i.e. the
coefficients on the same scale as the input rasters, we calculate the BC
right afterwards.</p>
<p><code>safeHavens</code> generates all kinds of things as it runs
through the functions <code>elasticSDM</code>,
<code>PostProcessSDM</code>, and <code>RescaleRasters</code>. Given that
one of these sampling scheme may be followed for quite some time, it is
best practice to save many of these objects.</p>
</div>
<div class="section level4">
<h4 id="save-results">save results<a class="anchor" aria-label="anchor" href="#save-results"></a>
</h4>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">bp</span> <span class="op">&lt;-</span> <span class="st">'~/Documents/assoRted/StrategizingGermplasmCollections'</span></span>
<span></span>
<span><span class="fu"><a href="../reference/writeSDMresults.html">writeSDMresults</a></span><span class="op">(</span></span>
<span>  cv_model <span class="op">=</span> <span class="va">sdModel</span><span class="op">$</span><span class="va">CVStructure</span>, </span>
<span>  pcnm <span class="op">=</span> <span class="va">sdModel</span><span class="op">$</span><span class="va">PCNM</span>, </span>
<span>  model <span class="op">=</span> <span class="va">sdModel</span><span class="op">$</span><span class="va">Model</span>, </span>
<span>  cm <span class="op">=</span> <span class="va">sdModel</span><span class="op">$</span><span class="va">ConfusionMatrix</span>, </span>
<span>  coef_tab <span class="op">=</span> <span class="va">rr</span><span class="op">$</span><span class="va">BetaCoefficients</span>, </span>
<span>  f_rasts <span class="op">=</span> <span class="va">threshold_rasts</span><span class="op">$</span><span class="va">FinalRasters</span>,</span>
<span>  thresh <span class="op">=</span> <span class="va">threshold_rasts</span><span class="op">$</span><span class="va">Threshold</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">bp</span>, <span class="st">'results'</span>, <span class="st">'SDM'</span><span class="op">)</span>, <span class="st">'Bradypus_test'</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># we can see that the files were placed here using this. </span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files</a></span><span class="op">(</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">bp</span>, <span class="st">'results'</span>, <span class="st">'SDM'</span><span class="op">)</span>, recursive <span class="op">=</span> <span class="cn">TRUE</span> <span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="wrapping-up">wrapping up<a class="anchor" aria-label="anchor" href="#wrapping-up"></a>
</h4>
<p>And there you have it, all the steps to make a species distribution
model - or rather to get the coefficients from a species distribution
model! We will play around with it as an example data set to compare our
buffered distance results to at the end - head over to the next
vignette!</p>
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Reed Benkendorf.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
