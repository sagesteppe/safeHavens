<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Getting Started • safeHavens</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Getting Started">
<meta name="description" content="Running the main sampling schemes for common species. ">
<meta property="og:description" content="Running the main sampling schemes for common species. ">
<meta property="og:image" content="https://sagesteppe.github.io/safeHavens/logo.png">
<!-- Google Search Console Verification --><meta name="google-site-verification" content="viUZcwXk_Fi5hsfdB7m6GgrFgGMJ-xVe1BcMTezGJII">
<!-- JSON-LD Structured Data for AI Crawlers --><script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "SoftwareApplication",
  "name": "safeHavens",
  "applicationCategory": "Scientific Software",
  "operatingSystem": "Windows, macOS, Linux",
  "softwareVersion": "0.0.0.9000",
  "description": "R package providing seven sampling schemes for germplasm curators to prioritize field collection efforts for ex situ plant conservation, including species distribution modeling optimized for germplasm sampling.",
  "url": "https://sagesteppe.github.io/safeHavens/",
  "downloadUrl": "https://github.com/sagesteppe/safeHavens",
  "author": {
    "@type": "Person",
    "name": "Reed Benkendorf",
    "url": "https://github.com/sagesteppe"
  },
  "programmingLanguage": "R",
  "keywords": [
    "germplasm conservation",
    "ex situ conservation",
    "plant conservation",
    "sampling design",
    "species distribution model",
    "SDM",
    "biodiversity",
    "seed collection",
    "R package",
    "conservation biology"
  ],
  "inLanguage": "en-US",
  "offers": {
    "@type": "Offer",
    "price": "0",
    "priceCurrency": "USD"
  }
}
</script><!-- Additional SEO Meta Tags --><meta name="robots" content="index, follow, max-snippet:-1, max-image-preview:large">
<meta name="keywords" content="germplasm conservation, ex situ conservation, plant conservation, sampling design, species distribution model, R package">
<meta name="author" content="Reed Benkendorf">
<link rel="canonical" href="https://sagesteppe.github.io/safeHavens/">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">safeHavens</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item"><a class="nav-link" href="../articles/index.html">Articles</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/sagesteppe/safeHavens/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Getting Started</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/sagesteppe/safeHavens/blob/main/vignettes/GettingStarted.Rmd" class="external-link"><code>vignettes/GettingStarted.Rmd</code></a></small>
      <div class="d-none name"><code>GettingStarted.Rmd</code></div>
    </div>

    
    
<div class="section level3">
<h3 id="set-up">set up<a class="anchor" aria-label="anchor" href="#set-up"></a>
</h3>
<p><code>safeHavens</code> can be installed directly from github.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#remotes::install_github('sagesteppe/safeHavens@tests') </span></span></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://sagesteppe.github.io/safeHavens/">safeHavens</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/" class="external-link">sf</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rspatial.org/" class="external-link">terra</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://jakubnowosad.com/spData/" class="external-link">spData</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://patchwork.data-imaginist.com" class="external-link">patchwork</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">23</span><span class="op">)</span> </span>
<span></span>
<span><span class="va">planar_proj</span> <span class="op">&lt;-</span> <span class="st">"+proj=laea +lat_0=-15 +lon_0=-60 +x_0=0 +y_0=0 +datum=WGS84 +units=m +no_defs"</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="defining-a-species-range-or-domain-for-sampling">Defining a Species Range or Domain for Sampling<a class="anchor" aria-label="anchor" href="#defining-a-species-range-or-domain-for-sampling"></a>
</h3>
<p>Central to the sampling schemes in <code>safeHavens</code> is a
species range or domain for sampling. For example, depending on the
goals of the collection, a curator may want to sample across the entire
range of a species. Alternatively one may be interested in sampling only
a portion of the range, e.g. a country, state, or ecoregion. Either of
these scenarios can be accomplished with the package. Here we will show
how to create a species range from occurrence data, and then use that
range to run the various sampling schemes.</p>
<p>Below we will use <code>sf</code> to simply buffer occurrence points
to create a species range across multiple South American nations.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span>package<span class="op">=</span><span class="st">"dismo"</span><span class="op">)</span>, <span class="st">'ex'</span>, <span class="st">'bradypus.csv'</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="va">x</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'lon'</span>, <span class="st">'lat'</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html" class="external-link">st_as_sf</a></span><span class="op">(</span><span class="va">x</span>, coords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'lon'</span>, <span class="st">'lat'</span><span class="op">)</span>, crs <span class="op">=</span> <span class="fl">4326</span><span class="op">)</span></span>
<span><span class="va">x_buff</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_transform.html" class="external-link">st_transform</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">planar_proj</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="co"># we are working in planar metric coordinates, we are</span></span>
<span>  <span class="co"># buffer by this many / 1000 kilometers. </span></span>
<span>  <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_unary.html" class="external-link">st_buffer</a></span><span class="op">(</span><span class="fl">125000</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sfc.html" class="external-link">st_as_sfc</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_combine.html" class="external-link">st_union</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">x_buff</span><span class="op">)</span></span></code></pre></div>
<p><img src="GettingStarted_files/figure-html/Just%20Buffer%20it!-1.png" class="r-plt" alt="" width="700"></p>
<p>Alternatives to this include a simple convex hull around a species,
if it is widespread throughout an area, or masking a binary SDM surface
as the domain.</p>
</div>
<div class="section level2">
<h2 id="prep-a-map-background">Prep a map background<a class="anchor" aria-label="anchor" href="#prep-a-map-background"></a>
</h2>
<p>We will use the <code>spData</code> package which uses <a href="https://www.naturalearthdata.com/" class="external-link">naturalearth</a> data for it’s
<code>world</code> data and is suitable for creating effective maps at a
variety of resolutions.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x_extra_buff</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_unary.html" class="external-link">st_buffer</a></span><span class="op">(</span><span class="va">x_buff</span>, <span class="fl">100000</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="co"># add a buffer to 'frame' the maps</span></span>
<span>  <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_transform.html" class="external-link">st_transform</a></span><span class="op">(</span><span class="fl">4326</span><span class="op">)</span></span>
<span></span>
<span><span class="va">americas</span> <span class="op">&lt;-</span> <span class="fu">spData</span><span class="fu">::</span><span class="va"><a href="https://jakubnowosad.com/spData/reference/world.html" class="external-link">world</a></span></span>
<span><span class="va">americas</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_crop.html" class="external-link">st_crop</a></span><span class="op">(</span><span class="va">americas</span>, <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_bbox.html" class="external-link">st_bbox</a></span><span class="op">(</span><span class="va">x_extra_buff</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">name_long</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: attribute variables are assumed to be spatially constant throughout</span></span>
<span><span class="co">#&gt; all geometries</span></span>
<span></span>
<span><span class="va">bb</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_bbox.html" class="external-link">st_bbox</a></span><span class="op">(</span><span class="va">x_extra_buff</span><span class="op">)</span></span>
<span></span>
<span><span class="va">map</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">americas</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span></span>
<span>    legend.position <span class="op">=</span> <span class="st">'none'</span>, </span>
<span>    panel.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_rect</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"aliceblue"</span><span class="op">)</span>, </span>
<span>    panel.grid.minor.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_line</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="st">"red"</span>, linetype <span class="op">=</span> <span class="fl">3</span>, linewidth  <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span>, </span>
<span>    axis.ticks<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    axis.text<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    plot.background<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_rect</a></span><span class="op">(</span>colour<span class="op">=</span><span class="st">"steelblue"</span><span class="op">)</span>,</span>
<span>    plot.margin<span class="op">=</span><span class="fu">grid</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/grid/unit.html" class="external-link">unit</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span>,<span class="st">"cm"</span><span class="op">)</span>,</span>
<span>    axis.ticks.length <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html" class="external-link">unit</a></span><span class="op">(</span><span class="fl">0</span>, <span class="st">"pt"</span><span class="op">)</span><span class="op">)</span><span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">coord_sf</a></span><span class="op">(</span>xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">bb</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="va">bb</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span><span class="op">)</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">bb</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, <span class="va">bb</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span><span class="op">)</span>, expand <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/rm.html" class="external-link">rm</a></span><span class="op">(</span><span class="va">x_extra_buff</span>, <span class="va">americas</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="running-the-various-sample-design-algorithms">Running the Various Sample Design Algorithms<a class="anchor" aria-label="anchor" href="#running-the-various-sample-design-algorithms"></a>
</h2>
<p>Now that we have some data which can represent species ranges, we can
run the various sampling approaches. The table in the introduction is
reproduced here.</p>
<table class="table">
<colgroup>
<col width="34%">
<col width="50%">
<col width="7%">
<col width="7%">
</colgroup>
<thead><tr class="header">
<th>Function</th>
<th>Description</th>
<th>Comp.</th>
<th>Envi.</th>
</tr></thead>
<tbody>
<tr class="odd">
<td><code>PointBasedSample</code></td>
<td>Creates points to make pieces over area</td>
<td>L</td>
<td>L</td>
</tr>
<tr class="even">
<td><code>EqualAreaSample</code></td>
<td>Breaks area into similar size pieces</td>
<td>L</td>
<td>L</td>
</tr>
<tr class="odd">
<td><code>OpportunisticSample</code></td>
<td>Using PBS with existing records</td>
<td>L</td>
<td>L</td>
</tr>
<tr class="even">
<td><code>KMedoidsBasedSample</code></td>
<td>Use ecoregions or STSz for sample</td>
<td>L</td>
<td>M</td>
</tr>
<tr class="odd">
<td><code>IBDBasedSample</code></td>
<td>Breaks species range into clusters</td>
<td>H</td>
<td>M</td>
</tr>
<tr class="even">
<td><code>PolygonBasedSample</code></td>
<td>Using existing ecoregions to sample</td>
<td>L</td>
<td>H</td>
</tr>
<tr class="odd">
<td><code>EnvironmentalBasedSample</code></td>
<td>Uses correlations from SDM to sample</td>
<td>H</td>
<td>H</td>
</tr>
</tbody>
</table>
<p><em>Note in this table ‘Comp.’ and ‘Envi.’ refer to computational and
environmental complexity respectively, and range from low (L) through
medium to high.</em></p>
<div class="section level3">
<h3 id="point-based-sample">Point Based Sample<a class="anchor" aria-label="anchor" href="#point-based-sample"></a>
</h3>
<p>INTRO HERE</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pbs</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/PointBasedSample.html">PointBasedSample</a></span><span class="op">(</span><span class="va">x_buff</span><span class="op">)</span></span>
<span><span class="va">pbs.sf</span> <span class="op">&lt;-</span> <span class="va">pbs</span><span class="op">[[</span><span class="st">'Geometry'</span><span class="op">]</span><span class="op">]</span></span>
<span></span>
<span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/valid.html" class="external-link">st_is_valid</a></span><span class="op">(</span><span class="va">x_buff</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span>
<span></span>
<span><span class="va">pbs.p</span> <span class="op">&lt;-</span> <span class="va">map</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">pbs.sf</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">ID</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span><span class="co">#  geom_sf_label(data = pbs.sf, aes(label = ID), alpha = 0.4) + </span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">'Point'</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">coord_sf</a></span><span class="op">(</span>expand <span class="op">=</span> <span class="cn">F</span><span class="op">)</span></span>
<span><span class="va">pbs.p</span></span></code></pre></div>
<p><img src="GettingStarted_files/figure-html/Point%20Based%20Sample-1.png" class="r-plt" alt="" width="700"></p>
</div>
<div class="section level3">
<h3 id="equal-area-sample">Equal Area Sample<a class="anchor" aria-label="anchor" href="#equal-area-sample"></a>
</h3>
<p>Perhaps the simplest method which is offered in
<code>safeHavens</code> is <code>EqualAreaSample</code>. It simply
creates many points, <code>pts</code> defaulting to 5000, within our
target domain and subjects them to k-means sampling where the groups are
specified by <code>n</code>, our target number of collections. The
individual points assigned to each group are merged into polygons which
‘take’ up all of the geographic space, and are intersected back to the
species range, and the area of each polygon is then measured. This
process will be ran a few times, defaulting to 100 <code>reps</code>,
and the set of polygons which was created during these reps with the
smallest variance in polygon size will be selected and returned.</p>
<p>This differs from point based sampling in that the above instance, we
start with a few regularly spaced points to grow from, here we take a
step back and by using many points let the clusters grow themselves to
similar sizes.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">eas</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/EqualAreaSample.html">EqualAreaSample</a></span><span class="op">(</span><span class="va">x_buff</span>, planar_proj <span class="op">=</span> <span class="va">planar_proj</span><span class="op">)</span> </span>
<span><span class="co">#&gt; Warning: did not converge in 10 iterations</span></span>
<span><span class="co">#&gt; Warning: did not converge in 10 iterations</span></span>
<span><span class="co">#&gt; Warning: did not converge in 10 iterations</span></span>
<span><span class="co">#&gt; Warning: did not converge in 10 iterations</span></span>
<span></span>
<span><span class="va">eas.p</span> <span class="op">&lt;-</span> <span class="va">map</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">eas</span><span class="op">[[</span><span class="st">'Geometry'</span><span class="op">]</span><span class="op">]</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">ID</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span><span class="co">#  geom_sf_label(data = eas.sf, aes(label = ID), alpha = 0.4) + </span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">'Equal Area'</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">coord_sf</a></span><span class="op">(</span>expand <span class="op">=</span> <span class="cn">F</span><span class="op">)</span></span>
<span><span class="va">eas.p</span></span></code></pre></div>
<p><img src="GettingStarted_files/figure-html/Equal%20Area%20Sample-1.png" class="r-plt" alt="" width="700"></p>
<p>The results look quite similar to point based sample.</p>
<pre><code><span><span class="co">#&gt; Warning in rm(eas, pbs, pbs.sf, tgs, grid_buff): object 'tgs' not found</span></span>
<span><span class="co">#&gt; Warning in rm(eas, pbs, pbs.sf, tgs, grid_buff): object 'grid_buff' not found</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="opportunistic-sample">Opportunistic Sample<a class="anchor" aria-label="anchor" href="#opportunistic-sample"></a>
</h3>
<p>Many curators are interested in how much they can embed their
existing collections into a sampling framework. The function
<code>OpportunisticSample</code> makes a few minor modifications to the
point based sample to maximize an existing collection. It doesn’t always
work exceptionally, especially when a couple collections are very close
to each other, but it may be a beneficial tool to have in the belt. As
we have observed, the three previous sampling schemes end of with
somewhat similar results - so we took used the
<code>PointBasedSample</code> as the framework we embedded this function
into it.</p>
<p>Essentially this combines the approach of point based sampling, but
forces that the clusters are based around the existing accessions. It
attempts to ‘center’ the existing collections within clusters, but this
can be nearly impossible for a variety of reasons.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">exist_pts</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_sample.html" class="external-link">st_sample</a></span><span class="op">(</span><span class="va">x_buff</span>, size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>   <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html" class="external-link">st_as_sf</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="co"># ^^ just randomly sampling 10 points in the species range</span></span>
<span>   <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>geometry <span class="op">=</span> <span class="va">x</span><span class="op">)</span></span>
<span></span>
<span><span class="va">os</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/OpportunisticSample.html">OpportunisticSample</a></span><span class="op">(</span>polygon <span class="op">=</span> <span class="va">x_buff</span>, n <span class="op">=</span> <span class="fl">20</span>, collections <span class="op">=</span> <span class="va">exist_pts</span><span class="op">)</span></span>
<span></span>
<span><span class="va">os.p</span> <span class="op">&lt;-</span> <span class="va">map</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">os</span><span class="op">[[</span><span class="st">'Geometry'</span><span class="op">]</span><span class="op">]</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">ID</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span><span class="co">#  geom_sf_label(data = os.sf, aes(label = ID), alpha = 0.4) + </span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">exist_pts</span>, alpha <span class="op">=</span> <span class="fl">0.4</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">'Opportunistic'</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">coord_sf</a></span><span class="op">(</span>expand <span class="op">=</span> <span class="cn">F</span><span class="op">)</span></span>
<span></span>
<span><span class="va">os.p</span></span></code></pre></div>
<p><img src="GettingStarted_files/figure-html/Opportunistic%20Sample-1.png" class="r-plt" alt="" width="700"></p>
<p>Here, the grids have been aligned around the points. This can lead to
some oddly shaped clusters, but <em>a bird in hand is worth two in the
bush.</em></p>
</div>
<div class="section level3">
<h3 id="isolation-by-distance-based-sample">Isolation by Distance Based Sample<a class="anchor" aria-label="anchor" href="#isolation-by-distance-based-sample"></a>
</h3>
<p>Isolation by Distance is the fundamental idea behind this package.
This function explicitly uses IBD to develop a sampling scheme, and does
not obfuscate it with any other parameters.</p>
<p>Note that this function requires a raster input, rather than a
vector.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">files</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files</a></span><span class="op">(</span> </span>
<span>  path <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span>package<span class="op">=</span><span class="st">"dismo"</span><span class="op">)</span>, <span class="st">'ex'</span><span class="op">)</span>,</span>
<span>  pattern <span class="op">=</span> <span class="st">'grd'</span>,  full.names<span class="op">=</span><span class="cn">TRUE</span> <span class="op">)</span> </span>
<span><span class="va">predictors</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/rast.html" class="external-link">rast</a></span><span class="op">(</span><span class="va">files</span><span class="op">)</span> </span>
<span></span>
<span><span class="va">x_buff.sf</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html" class="external-link">st_as_sf</a></span><span class="op">(</span><span class="va">x_buff</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>Range <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_transform.html" class="external-link">st_transform</a></span><span class="op">(</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/crs.html" class="external-link">crs</a></span><span class="op">(</span><span class="va">predictors</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># and here we specify the field/column with our variable we want to become an attribute of our raster</span></span>
<span><span class="va">v</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/rasterize.html" class="external-link">rasterize</a></span><span class="op">(</span><span class="va">x_buff.sf</span>, <span class="va">predictors</span>, field <span class="op">=</span> <span class="st">'Range'</span><span class="op">)</span> </span>
<span></span>
<span><span class="co"># now we run the function demanding 20 areas to make accessions from, </span></span>
<span><span class="va">ibdbs</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/IBDBasedSample.html">IBDBasedSample</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">v</span>, n <span class="op">=</span> <span class="fl">20</span>, fixedClusters <span class="op">=</span> <span class="cn">TRUE</span>, template <span class="op">=</span> <span class="va">predictors</span>, planar_proj <span class="op">=</span> <span class="va">planar_proj</span><span class="op">)</span></span>
<span></span>
<span><span class="va">ibdbs.p</span> <span class="op">&lt;-</span> <span class="va">map</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">ibdbs</span><span class="op">[[</span><span class="st">'Geometry'</span><span class="op">]</span><span class="op">]</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">ID</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span><span class="co">#  geom_sf_label(data = os.sf, aes(label = ID), alpha = 0.4) + </span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">'IBD'</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">coord_sf</a></span><span class="op">(</span>expand <span class="op">=</span> <span class="cn">F</span><span class="op">)</span></span>
<span></span>
<span><span class="va">ibdbs.p</span></span></code></pre></div>
<p><img src="GettingStarted_files/figure-html/Isolatation%20by%20Distance%20Example-1.png" class="r-plt" alt="" width="700"></p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/rm.html" class="external-link">rm</a></span><span class="op">(</span><span class="va">predictors</span>, <span class="va">files</span>, <span class="va">v</span>, <span class="va">x_buff.sf</span>, <span class="va">exist_pts</span>, <span class="va">os</span><span class="op">)</span></span></code></pre></div>
<p>Because these data were processed from a raster, they have lienar
edges, representing raster tiles. However, it is evident that the
borders of the clusters are more natural looking than in the previous
(and future) sampling schemes.</p>
</div>
<div class="section level3">
<h3 id="polygon-based-sample">Polygon Based Sample<a class="anchor" aria-label="anchor" href="#polygon-based-sample"></a>
</h3>
<p>This is the most commonly implemented method for guiding native seed
collection in North America. However, I am not sure exactly how
practitioners all implement it, and whether the formats of application
are consistent among practitioners! For these reasons a few different
sets of options are supported for a user.</p>
<p>For general usage, two parameters are always required <code>x</code>
which is the species range as an sf object, and <code>ecoregions</code>,
the sf object containing the ecoregions of interest. The
<code>ecoregions</code> file does not need to be subset to the range of
<code>x</code> quite yet - the function will take care of that.
Additional arguments to the function include as usual <code>n</code> to
specify how many accession we are looking for in our collection. Two
additional arguments relate to whether we are using Omernik Level 4
ecoregions data or ecoregions (or biogeographic regions) from another
source. These are <code>OmernikEPA</code>, and
<code>ecoregion_col</code>, if you are using the official EPA release of
ecoregions then both of these are optional, however if you are not using
the EPA product than both <em>should</em> be supplied - but only the
<code>ecoregion_col</code> argument is totally necessary. This column
should contain unique names for the highest resolution level ecoregion
you want to use from the data set, for many data sets, such as our
example we call ‘neo_eco’ this may be the only field with ecolevel
information!</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">neo_eco</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html" class="external-link">st_read</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span>package<span class="op">=</span><span class="st">"safeHavens"</span><span class="op">)</span>, <span class="st">'extdata'</span>, <span class="st">'NeoTropicsEcoregions.gpkg'</span><span class="op">)</span>, </span>
<span>  quiet <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>geometry <span class="op">=</span> <span class="va">geom</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/headtail.html" class="external-link">head</a></span><span class="op">(</span><span class="va">neo_eco</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">3</span>, <span class="fl">4</span>, <span class="fl">6</span>, <span class="fl">11</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co">#&gt; Simple feature collection with 6 features and 4 fields</span></span>
<span><span class="co">#&gt; Geometry type: MULTIPOLYGON</span></span>
<span><span class="co">#&gt; Dimension:     XY</span></span>
<span><span class="co">#&gt; Bounding box:  xmin: -103.0432 ymin: -31.25308 xmax: -34.79344 ymax: 26.91751</span></span>
<span><span class="co">#&gt; Geodetic CRS:  WGS 84</span></span>
<span><span class="co">#&gt;                  Provincias      Region      Dominio</span></span>
<span><span class="co">#&gt; 1 Araucaria Forest province Neotropical       Parana</span></span>
<span><span class="co">#&gt; 2          Atacama province Neotropical         &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 3         Atlantic province Neotropical       Parana</span></span>
<span><span class="co">#&gt; 4           Bahama province Neotropical         &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 5     Balsas Basin province Neotropical Mesoamerican</span></span>
<span><span class="co">#&gt; 6         Caatinga province Neotropical      Chacoan</span></span>
<span><span class="co">#&gt;                        Subregion                       geometry</span></span>
<span><span class="co">#&gt; 1                        Chacoan MULTIPOLYGON (((-53.58012 -...</span></span>
<span><span class="co">#&gt; 2 South American Transition Zone MULTIPOLYGON (((-69.42981 -...</span></span>
<span><span class="co">#&gt; 3                        Chacoan MULTIPOLYGON (((-48.41217 -...</span></span>
<span><span class="co">#&gt; 4                      Antillean MULTIPOLYGON (((-77.58593 2...</span></span>
<span><span class="co">#&gt; 5                      Brazilian MULTIPOLYGON (((-97.37265 1...</span></span>
<span><span class="co">#&gt; 6                        Chacoan MULTIPOLYGON (((-35.56652 -...</span></span>
<span></span>
<span><span class="va">x_buff</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_transform.html" class="external-link">st_transform</a></span><span class="op">(</span><span class="va">x_buff</span>, <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_crs.html" class="external-link">st_crs</a></span><span class="op">(</span><span class="va">neo_eco</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">ebs.sf</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/PolygonBasedSample.html">PolygonBasedSample</a></span><span class="op">(</span><span class="va">x_buff</span>, zones <span class="op">=</span> <span class="va">neo_eco</span>, n <span class="op">=</span> <span class="fl">10</span>, zone_key <span class="op">=</span> <span class="st">'Provincias'</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning in st_collection_extract.sf(zones_poly, "POLYGON", warn = FALSE): x is</span></span>
<span><span class="co">#&gt; already of type POLYGON.</span></span>
<span></span>
<span><span class="co"># crop it to the other objects for plotting</span></span>
<span><span class="va">ebs.sf</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_crop.html" class="external-link">st_crop</a></span><span class="op">(</span><span class="va">ebs.sf</span>, <span class="va">bb</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: attribute variables are assumed to be spatially constant throughout</span></span>
<span><span class="co">#&gt; all geometries</span></span>
<span></span>
<span><span class="va">ebs.p</span> <span class="op">&lt;-</span> <span class="va">map</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">ebs.sf</span> , <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">allocation</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">'Ecoregion'</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">coord_sf</a></span><span class="op">(</span>expand <span class="op">=</span> <span class="cn">F</span><span class="op">)</span></span></code></pre></div>
<p>This output differs from the others we will see, here we have
depicted the number of collections to be made per ecoregion. Because the
number of ecoregions is greater than our requested sample size, the
return object can only take on two values - no collections, or one
collection.</p>
</div>
<div class="section level3">
<h3 id="environmental-based-sample">Environmental Based Sample<a class="anchor" aria-label="anchor" href="#environmental-based-sample"></a>
</h3>
<p>The environmental based sample can only be conducted if you have the
species distribution model data. Included in the data directory of the
folder are all of the objects required to run this example for the
species. We will load them here.</p>
</div>
</div>
<div class="section level2">
<h2 id="load-the-sdm-predictions">load the SDM predictions<a class="anchor" aria-label="anchor" href="#load-the-sdm-predictions"></a>
</h2>
<p>The package also has an SDM prediction saved in the data we can just
load that too for a couple comparisons.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sdm</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/rast.html" class="external-link">rast</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span>package<span class="op">=</span><span class="st">"safeHavens"</span><span class="op">)</span>, <span class="st">'extdata'</span>, <span class="st">'Bradypus_test.tif'</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">sdm</span><span class="op">)</span></span></code></pre></div>
<p><img src="GettingStarted_files/figure-html/unnamed-chunk-5-1.png" class="r-plt" alt="" width="700"></p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sdModel</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/serialize.html" class="external-link">readRDS</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span>package<span class="op">=</span><span class="st">"safeHavens"</span><span class="op">)</span>, <span class="st">'extdata'</span>,  <span class="st">'sdModel.rds'</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">sdModel</span><span class="op">$</span><span class="va">RasterPredictions</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/wrap.html" class="external-link">unwrap</a></span><span class="op">(</span><span class="va">sdModel</span><span class="op">$</span><span class="va">RasterPredictions</span><span class="op">)</span></span>
<span><span class="va">sdModel</span><span class="op">$</span><span class="va">Predictors</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/wrap.html" class="external-link">unwrap</a></span><span class="op">(</span><span class="va">sdModel</span><span class="op">$</span><span class="va">Predictors</span><span class="op">)</span></span>
<span><span class="va">sdModel</span><span class="op">$</span><span class="va">PCNM</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/wrap.html" class="external-link">unwrap</a></span><span class="op">(</span><span class="va">sdModel</span><span class="op">$</span><span class="va">PCNM</span><span class="op">)</span></span></code></pre></div>
<p>Once these data are loaded into R, we will scale the rasters (using
<code>RescaleRasters</code>) which will serve as surfaces to predict
from (this is also done above!), then we will run the algorithm
(<code>EnvironmentalBasedSample</code>). However, before we run the
algorithm we will need to create a directory (also called a ‘folder’),
on our computers to save the results from the function
<code>EnvironmentalBasedSample</code>. Whereas earlier in this vignette
we showcased that the functions generated the species distribution
model, and us saving the results were a two stage process (e.g. to
create the SDM and associated products we used: <code>elasticSDM</code>,
<code>PostProcessSDM</code>, and <code>RescaleRasters</code>, before
finally saving relevant data with <code>writeSDMresults</code>), this
function produces both the product and writes out ancillary data
simultaneously.<br>
This approach was chosen as this function is only writing out four
objects: 1) the groups as vector data, 2) and the groups as raster data,
3) the k-nearest neighbors (knn) model used to generate these clusters,
and 4) the confusion matrix associated with testing the knn model.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rr</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/RescaleRasters.html">RescaleRasters</a></span><span class="op">(</span> <span class="co"># you may have already done this!</span></span>
<span>  model <span class="op">=</span> <span class="va">sdModel</span><span class="op">$</span><span class="va">Model</span>,</span>
<span>  predictors <span class="op">=</span> <span class="va">sdModel</span><span class="op">$</span><span class="va">Predictors</span>, </span>
<span>  training_data <span class="op">=</span> <span class="va">sdModel</span><span class="op">$</span><span class="va">TrainData</span>, </span>
<span>  pred_mat <span class="op">=</span> <span class="va">sdModel</span><span class="op">$</span><span class="va">PredictMatrix</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="co"># create a directory to hold the results from EBS real quick. </span></span>
<span><span class="co"># we will default to placing it in your current working directory. </span></span>
<span><span class="co"># If you are a data management freak don't worry too much about this. </span></span>
<span><span class="co"># The code to remove the directory will be provided below. </span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/getwd.html" class="external-link">getwd</a></span><span class="op">(</span><span class="op">)</span> <span class="co"># this is where the folder is going to located IF YOU DON'T RUN the code below. </span></span>
<span><span class="co">#&gt; [1] "/home/runner/work/safeHavens/safeHavens/vignettes"</span></span>
<span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="st">'~'</span>, <span class="st">'Documents'</span><span class="op">)</span> <span class="co"># in my case I'll dump it in Documents real quick, this should work on </span></span>
<span><span class="co"># Linux and Mac, but I don't think Windows? </span></span>
<span><span class="co"># dir.create(file.path(p, 'safeHavens-Vignette')) # now create the directory. </span></span>
<span></span>
<span><span class="va">planar_proj</span> <span class="op">&lt;-</span> <span class="st">"+proj=laea +lat_0=-15 +lon_0=-60 +x_0=0 +y_0=0 +datum=WGS84 +units=m +no_defs"</span></span>
<span></span>
<span><span class="va">ENVIbs</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/EnvironmentalBasedSample.html">EnvironmentalBasedSample</a></span><span class="op">(</span></span>
<span>  pred_rescale <span class="op">=</span> <span class="va">rr</span><span class="op">$</span><span class="va">RescaledPredictors</span>, </span>
<span>  write2disk <span class="op">=</span> <span class="cn">FALSE</span>, </span>
<span>  path <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">p</span>, <span class="st">'safeHavens-Vignette'</span><span class="op">)</span>, <span class="co"># we are not writing, but showing how to provide argument</span></span>
<span>  taxon <span class="op">=</span> <span class="st">'Bradypus_test'</span>, </span>
<span>  f_rasts <span class="op">=</span> <span class="va">sdm</span>, n <span class="op">=</span> <span class="fl">20</span>, </span>
<span>  lyr <span class="op">=</span> <span class="st">'Supplemented'</span>,</span>
<span>  fixedClusters <span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span>  n_pts <span class="op">=</span> <span class="fl">500</span>, </span>
<span>  planar_proj <span class="op">=</span> <span class="va">planar_proj</span>,</span>
<span>  buffer_d <span class="op">=</span> <span class="fl">3</span>,</span>
<span>  prop_split <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span></span>
<span></span>
<span><span class="va">ENVIbs.p</span> <span class="op">&lt;-</span> <span class="va">map</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">ENVIbs</span><span class="op">[[</span><span class="st">'Geometry'</span><span class="op">]</span><span class="op">]</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">ID</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="co">#geom_sf_label(data = ENVIbs, aes(label = ID), alpha = 0.4) + </span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">'Environmental'</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">coord_sf</a></span><span class="op">(</span>expand <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">#&gt; Coordinate system already present.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Adding new coordinate system, which will replace the existing one.</span></span>
<span></span>
<span><span class="va">ENVIbs.p</span></span></code></pre></div>
<p><img src="GettingStarted_files/figure-html/Environmental%20Based%20Sample-1.png" class="r-plt" alt="" width="700"></p>
<p>The function <code>EnvironmentalBasedSample</code> can take any of
the three binary rasters created by <code>PostProcessSDM</code> as
arguments for the template. Here we showcase the different results from
using each of them.</p>
<p><img src="GettingStarted_files/figure-html/Compare%20Environmental%20Based%20Samples-1.png" class="r-plt" alt="" width="700"></p>
<p>These plots are able to showcase the difference in results depending
on which of the three input rasters are utilized. As with all of the
sampling schemes, results vary widely based on the spatial extents which
the functions are applied to. Using the SDM output which have undergone
thresholding results in the largest classified area. At first glance the
results may seem very different, but if you look at central america,
they are largely consistent, as they are near the Andes; large
differences do exist in the Amazon Basin, but even there some alignment
between the systems is evident. Accordingly, the surface used for a
species should match some evaluation criterion.</p>
<p>Using the threshold raster surface is a very good option if we do not
want to ‘miss’ too many areas, whereas the clipped and supplemented
options may be better suited for scenarios where we do not want to draw
up clusters, which lack any populations which can be collected from.</p>
</div>
<div class="section level2">
<h2 id="comparision-of-different-sampling-schemes">Comparision of different sampling schemes<a class="anchor" aria-label="anchor" href="#comparision-of-different-sampling-schemes"></a>
</h2>
<p>So, we’ve made got some maps for you to look at! They all look
relatively similar to me when plotted one after another, let’s plot them
all simultaneously and see if that’s still the case.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pbs.p</span> <span class="op">+</span> <span class="va">eas.p</span> <span class="op">+</span> <span class="va">os.p</span>  <span class="op">+</span>  <span class="va">ibdbs.p</span> <span class="op">+</span> <span class="va">ebs.p</span> <span class="op">+</span> <span class="va">ENVIbs.p</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://patchwork.data-imaginist.com/reference/plot_layout.html" class="external-link">plot_layout</a></span><span class="op">(</span>ncol <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span></code></pre></div>
<p><img src="GettingStarted_files/figure-html/Plot%20all%20Sampling%20Schemes%20together-1.png" class="r-plt" alt="" width="700"></p>
<p>Again, the XX figures appear quite similar, with the
<code>Opportunistic</code> method only deviating slightly form them. In
my mind isolation by distance (IBD) show the biggest different, it seems
to have made the most <em>sense</em> of the naturally occurring
patchiness of the species range. Environmental also seems to partition
the feature space quite well. Notably drawing a couple clusters in the
Pacific lowlands and Northern Andes mountains.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Reed Benkendorf.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
