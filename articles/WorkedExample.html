<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Worked Example • safeHavens</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Worked Example">
<meta name="description" content="Downloading species occurrence data, creating hulls, sampling and writing out data for sample design. ">
<meta property="og:description" content="Downloading species occurrence data, creating hulls, sampling and writing out data for sample design. ">
<meta property="og:image" content="https://sagesteppe.github.io/safeHavens/logo.png">
<!-- Google Search Console Verification --><meta name="google-site-verification" content="viUZcwXk_Fi5hsfdB7m6GgrFgGMJ-xVe1BcMTezGJII">
<!-- JSON-LD Structured Data for AI Crawlers --><script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "SoftwareApplication",
  "name": "safeHavens",
  "applicationCategory": "Scientific Software",
  "operatingSystem": "Windows, macOS, Linux",
  "softwareVersion": "0.0.0.9000",
  "description": "R package providing seven sampling schemes for germplasm curators to prioritize field collection efforts for ex situ plant conservation, including species distribution modeling optimized for germplasm sampling.",
  "url": "https://sagesteppe.github.io/safeHavens/",
  "downloadUrl": "https://github.com/sagesteppe/safeHavens",
  "author": {
    "@type": "Person",
    "name": "Reed Benkendorf",
    "url": "https://github.com/sagesteppe"
  },
  "programmingLanguage": "R",
  "keywords": [
    "germplasm conservation",
    "ex situ conservation",
    "plant conservation",
    "sampling design",
    "species distribution model",
    "SDM",
    "biodiversity",
    "seed collection",
    "R package",
    "conservation biology"
  ],
  "inLanguage": "en-US",
  "offers": {
    "@type": "Offer",
    "price": "0",
    "priceCurrency": "USD"
  }
}
</script><!-- Additional SEO Meta Tags --><meta name="robots" content="index, follow, max-snippet:-1, max-image-preview:large">
<meta name="keywords" content="germplasm conservation, ex situ conservation, plant conservation, sampling design, species distribution model, R package">
<meta name="author" content="Reed Benkendorf">
<link rel="canonical" href="https://sagesteppe.github.io/safeHavens/">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">safeHavens</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item"><a class="nav-link" href="../articles/index.html">Articles</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/sagesteppe/safeHavens/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Worked Example</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/sagesteppe/safeHavens/blob/main/vignettes/WorkedExample.Rmd" class="external-link"><code>vignettes/WorkedExample.Rmd</code></a></small>
      <div class="d-none name"><code>WorkedExample.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>The previous tutorials focus on the individual <em>functions</em> in
the package, but do little to show <em>how</em> to integrate them into
common workflows to develop spatial products for sampling. Here we show
a minimal example of how a curator may load occurrence data for a
species, apply a couple sampling approaches to these data, and save the
results for use. We will use two species native to the Southwestern
United States &amp; Mexico for this example, eventually narrowing our
focus to discuss only one for the sake of brevity.</p>
<p>While we only have two species in the example, the code is setup to
accomodate as many species as an analyst desires to process
simultaneously.</p>
<div class="section level3">
<h3 id="data-prep">Data prep<a class="anchor" aria-label="anchor" href="#data-prep"></a>
</h3>
<p>You will need to install <code>rgbif</code> to follow along with this
example. <code>rgbif</code> is an amazing package maintained by ROpenSci
to acess the Global Biodiversity Information Facility database from
within R. Note that a (free, and esay to get), GBIF profile is required
for larger data downloads, but for this example all you need is the R
package.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://sagesteppe.github.io/safeHavens/">safeHavens</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/" class="external-link">sf</a></span><span class="op">)</span> <span class="co"># spatial data</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span> <span class="co"># general data handling</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org" class="external-link">tidyr</a></span><span class="op">)</span> <span class="co"># general data handling</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://purrr.tidyverse.org/" class="external-link">purrr</a></span><span class="op">)</span> <span class="co"># mapping functions across lists.</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span> <span class="co">## for maps </span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://docs.ropensci.org/rgbif" class="external-link">rgbif</a></span><span class="op">)</span> <span class="co"># species occurrence data.</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://jakubnowosad.com/spData/" class="external-link">spData</a></span><span class="op">)</span> <span class="co"># example cartography data</span></span></code></pre></div>
<p>Using <code>rgbif</code> we’ll download occurrence data for a couple
species, just so we have the code set up for <code>mapping</code>
through multiple species in a more realistic manner.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## small subset of useful columns for example</span></span>
<span><span class="va">cols</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'decimalLatitude'</span>, <span class="st">'decimalLongitude'</span>, <span class="st">'dateIdentified'</span>, <span class="st">'species'</span>, <span class="st">'acceptedScientificName'</span>, <span class="st">'datasetName'</span>, </span>
<span>  <span class="st">'coordinateUncertaintyInMeters'</span>, <span class="st">'basisOfRecord'</span>, <span class="st">'institutionCode'</span>, <span class="st">'catalogNumber'</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## download species data using scientificName, can use keys and lookup tables for automating many taxa. </span></span>
<span><span class="va">cymu</span> <span class="op">&lt;-</span> <span class="fu">rgbif</span><span class="fu">::</span><span class="fu"><a href="https://docs.ropensci.org/rgbif/reference/occ_search.html" class="external-link">occ_search</a></span><span class="op">(</span>scientificName <span class="op">=</span> <span class="st">"Vesper multinervatus"</span>, limit <span class="op">=</span> <span class="fl">1000</span><span class="op">)</span></span>
<span></span>
<span><span class="co">### check to see what CRS are in here, these days usually standardized to wgs84 (epsg:4326)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span> <span class="va">cymu</span><span class="op">[[</span><span class="st">'data'</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="st">'geodeticDatum'</span><span class="op">]</span><span class="op">)</span> </span>
<span><span class="va">geodeticDatum</span></span>
<span><span class="va">WGS84</span> </span>
<span>  <span class="fl">676</span> </span>
<span></span>
<span><span class="co">## subset the data to relevant columns </span></span>
<span><span class="va">cymu_cols</span> <span class="op">&lt;-</span> <span class="va">cymu</span><span class="op">[[</span><span class="st">'data'</span><span class="op">]</span><span class="op">]</span><span class="op">[</span>,<span class="va">cols</span><span class="op">]</span></span>
<span></span>
<span><span class="co">## repeat this again so a second set of data are on hand </span></span>
<span><span class="va">bowa</span> <span class="op">&lt;-</span> <span class="fu">rgbif</span><span class="fu">::</span><span class="fu"><a href="https://docs.ropensci.org/rgbif/reference/occ_search.html" class="external-link">occ_search</a></span><span class="op">(</span>scientificName <span class="op">=</span> <span class="st">"Bouteloua warnockii"</span>, limit <span class="op">=</span> <span class="fl">1000</span><span class="op">)</span></span>
<span><span class="va">bowa_cols</span> <span class="op">&lt;-</span> <span class="va">bowa</span><span class="op">[[</span><span class="st">'data'</span><span class="op">]</span><span class="op">]</span><span class="op">[</span>,<span class="va">cols</span><span class="op">]</span></span>
<span></span>
<span><span class="co">## contrived multispecies example. </span></span>
<span><span class="va">spp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="va">bowa_cols</span>, <span class="va">cymu_cols</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/drop_na.html" class="external-link">drop_na</a></span><span class="op">(</span><span class="va">decimalLatitude</span>, <span class="va">decimalLongitude</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="co"># any missing coords need dropped. </span></span>
<span>  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html" class="external-link">st_as_sf</a></span><span class="op">(</span>coords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span> <span class="st">'decimalLongitude'</span>, <span class="st">'decimalLatitude'</span><span class="op">)</span>, crs <span class="op">=</span> <span class="fl">4326</span>, remove <span class="op">=</span> <span class="cn">F</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/rm.html" class="external-link">rm</a></span><span class="op">(</span><span class="va">cymu</span>, <span class="va">bowa</span>, <span class="va">cols</span>, <span class="va">cymu_cols</span>, <span class="va">bowa_cols</span><span class="op">)</span></span></code></pre></div>
<p>Take a quick look at the data to see if there are any clear errors.
One points location is incorrect, it’s latitude is great - we remove it
below.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">western_states</span> <span class="op">&lt;-</span> <span class="fu">spData</span><span class="fu">::</span><span class="va"><a href="https://jakubnowosad.com/spData/reference/us_states.html" class="external-link">us_states</a></span> <span class="op">|&gt;</span> <span class="co">## for making a quick basemap. </span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">REGION</span> <span class="op">==</span> <span class="st">'West'</span> <span class="op">&amp;</span> <span class="op">!</span> <span class="va">NAME</span> <span class="op"><a href="https://rspatial.github.io/terra/reference/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'Montana'</span>, <span class="st">'Washington'</span>, <span class="st">'Idaho'</span>, <span class="st">'Oregon'</span>, <span class="st">'Wyoming'</span><span class="op">)</span> <span class="op">|</span></span>
<span>   <span class="va">NAME</span> <span class="op"><a href="https://rspatial.github.io/terra/reference/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'Oklahoma'</span>, <span class="st">'Texas'</span>, <span class="st">'Kansas'</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">NAME</span>, <span class="va">geometry</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_transform.html" class="external-link">st_transform</a></span><span class="op">(</span><span class="fl">4326</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">western_states</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">spp</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>color <span class="op">=</span> <span class="va">species</span>, shape <span class="op">=</span> <span class="va">species</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_void</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">'bottom'</span><span class="op">)</span></span></code></pre></div>
<p><img src="WorkedExample_files/figure-html/check%20gbif%20data-1.png" class="r-plt" alt="" width="700"></p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a></span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a><span class="do">## check the outlying record. </span></span>
<span id="cb4-3"><a href="#cb4-3" tabindex="-1"></a><span class="fu">arrange</span>(spp, <span class="at">by =</span> decimalLatitude, <span class="at">desc=</span><span class="cn">FALSE</span>) <span class="sc">|&gt;</span></span>
<span id="cb4-4"><a href="#cb4-4" tabindex="-1"></a>  <span class="fu">head</span>(<span class="dv">5</span>)</span>
<span id="cb4-5"><a href="#cb4-5" tabindex="-1"></a>Simple feature collection with <span class="dv">5</span> features and <span class="dv">10</span> fields</span>
<span id="cb4-6"><a href="#cb4-6" tabindex="-1"></a>Geometry type<span class="sc">:</span> POINT</span>
<span id="cb4-7"><a href="#cb4-7" tabindex="-1"></a>Dimension<span class="sc">:</span>     XY</span>
<span id="cb4-8"><a href="#cb4-8" tabindex="-1"></a>Bounding box<span class="sc">:</span>  xmin<span class="sc">:</span> <span class="sc">-</span><span class="fl">102.8461</span> ymin<span class="sc">:</span> <span class="fl">26.2436</span> xmax<span class="sc">:</span> <span class="sc">-</span><span class="fl">101.343</span> ymax<span class="sc">:</span> <span class="fl">26.30833</span></span>
<span id="cb4-9"><a href="#cb4-9" tabindex="-1"></a>Geodetic CRS<span class="sc">:</span>  WGS <span class="dv">84</span></span>
<span id="cb4-10"><a href="#cb4-10" tabindex="-1"></a> [<span class="dv">38</span>;<span class="dv">5</span>;<span class="dv">246</span>m<span class="co"># A tibble: 5 × 11 [39m</span></span>
<span id="cb4-11"><a href="#cb4-11" tabindex="-1"></a>  decimalLatitude decimalLongitude dateIdentified species acceptedScientificName</span>
<span id="cb4-12"><a href="#cb4-12" tabindex="-1"></a>             [<span class="dv">3</span>m [<span class="dv">38</span>;<span class="dv">5</span>;<span class="dv">246</span>m<span class="sc">&lt;</span>dbl<span class="sc">&gt;</span> [<span class="dv">39</span>m [<span class="dv">23</span>m             [<span class="dv">3</span>m [<span class="dv">38</span>;<span class="dv">5</span>;<span class="dv">246</span>m<span class="sc">&lt;</span>dbl<span class="sc">&gt;</span> [<span class="dv">39</span>m [<span class="dv">23</span>m  [<span class="dv">3</span>m [<span class="dv">38</span>;<span class="dv">5</span>;<span class="dv">246</span>m<span class="sc">&lt;</span>chr<span class="sc">&gt;</span> [<span class="dv">39</span>m [<span class="dv">23</span>m           [<span class="dv">3</span>m [<span class="dv">38</span>;<span class="dv">5</span>;<span class="dv">246</span>m<span class="sc">&lt;</span>chr<span class="sc">&gt;</span> [<span class="dv">39</span>m [<span class="dv">23</span>m    [<span class="dv">3</span>m [<span class="dv">38</span>;<span class="dv">5</span>;<span class="dv">246</span>m<span class="sc">&lt;</span>chr<span class="sc">&gt;</span> [<span class="dv">39</span>m [<span class="dv">23</span>m                 </span>
<span id="cb4-13"><a href="#cb4-13" tabindex="-1"></a> [<span class="dv">38</span>;<span class="dv">5</span>;<span class="dv">250</span>m1 [<span class="dv">39</span>m            <span class="fl">26.2</span>            <span class="sc">-</span> [<span class="dv">31</span>m103 [<span class="dv">39</span>m [<span class="dv">31</span>m. [<span class="dv">39</span>m  [<span class="dv">31</span>mNA [<span class="dv">39</span>m             Boutel… Bouteloua warnockii G…</span>
<span id="cb4-14"><a href="#cb4-14" tabindex="-1"></a> [<span class="dv">38</span>;<span class="dv">5</span>;<span class="dv">250</span>m2 [<span class="dv">39</span>m            <span class="fl">26.2</span>            <span class="sc">-</span> [<span class="dv">31</span>m103 [<span class="dv">39</span>m [<span class="dv">31</span>m. [<span class="dv">39</span>m  [<span class="dv">31</span>mNA [<span class="dv">39</span>m             Boutel… Bouteloua warnockii G…</span>
<span id="cb4-15"><a href="#cb4-15" tabindex="-1"></a> [<span class="dv">38</span>;<span class="dv">5</span>;<span class="dv">250</span>m3 [<span class="dv">39</span>m            <span class="fl">26.2</span>            <span class="sc">-</span> [<span class="dv">31</span>m103 [<span class="dv">39</span>m [<span class="dv">31</span>m. [<span class="dv">39</span>m  [<span class="dv">31</span>mNA [<span class="dv">39</span>m             Boutel… Bouteloua warnockii G…</span>
<span id="cb4-16"><a href="#cb4-16" tabindex="-1"></a> [<span class="dv">38</span>;<span class="dv">5</span>;<span class="dv">250</span>m4 [<span class="dv">39</span>m            <span class="fl">26.3</span>            <span class="sc">-</span> [<span class="dv">31</span>m101 [<span class="dv">39</span>m [<span class="dv">31</span>m. [<span class="dv">39</span>m  [<span class="dv">31</span>mNA [<span class="dv">39</span>m             Boutel… Bouteloua warnockii G…</span>
<span id="cb4-17"><a href="#cb4-17" tabindex="-1"></a> [<span class="dv">38</span>;<span class="dv">5</span>;<span class="dv">250</span>m5 [<span class="dv">39</span>m            <span class="fl">26.3</span>            <span class="sc">-</span> [<span class="dv">31</span>m101 [<span class="dv">39</span>m [<span class="dv">31</span>m. [<span class="dv">39</span>m  [<span class="dv">31</span>mNA [<span class="dv">39</span>m             Boutel… Bouteloua warnockii G…</span>
<span id="cb4-18"><a href="#cb4-18" tabindex="-1"></a> [<span class="dv">38</span>;<span class="dv">5</span>;<span class="dv">246</span>m<span class="co"># ℹ 6 more variables: datasetName &lt;chr&gt;, coordinateUncertaintyInMeters &lt;dbl&gt;, [39m</span></span>
<span id="cb4-19"><a href="#cb4-19" tabindex="-1"></a> [<span class="dv">38</span>;<span class="dv">5</span>;<span class="dv">246</span>m<span class="co">#   basisOfRecord &lt;chr&gt;, institutionCode &lt;chr&gt;, catalogNumber &lt;chr&gt;, [39m</span></span>
<span id="cb4-20"><a href="#cb4-20" tabindex="-1"></a> [<span class="dv">38</span>;<span class="dv">5</span>;<span class="dv">246</span>m<span class="co">#   geometry &lt;POINT [°]&gt; [39m</span></span>
<span id="cb4-21"><a href="#cb4-21" tabindex="-1"></a></span>
<span id="cb4-22"><a href="#cb4-22" tabindex="-1"></a><span class="do">## remove it based on it's latitude. </span></span>
<span id="cb4-23"><a href="#cb4-23" tabindex="-1"></a>spp <span class="ot">&lt;-</span> <span class="fu">filter</span>(spp, decimalLatitude <span class="sc">&lt;=</span> <span class="dv">40</span>)</span></code></pre></div>
<p>A few tools exist for quickly cleaning GBIF data, <code>gatoRs</code>
is a recently published great choice for this.</p>
<p>Map the data again, and keep the ggplot around as a basemap for the
rest of vignette.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">bb</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_transform.html" class="external-link">st_transform</a></span><span class="op">(</span><span class="va">spp</span>, <span class="fl">5070</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_unary.html" class="external-link">st_buffer</a></span><span class="op">(</span><span class="fl">100000</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_transform.html" class="external-link">st_transform</a></span><span class="op">(</span><span class="fl">4326</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_bbox.html" class="external-link">st_bbox</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">western_states</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_crop.html" class="external-link">st_crop</a></span><span class="op">(</span><span class="va">western_states</span>, <span class="va">bb</span><span class="op">)</span></span>
<span></span>
<span><span class="va">base</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">western_states</span>, color <span class="op">=</span> <span class="st">'white'</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">spp</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>color <span class="op">=</span> <span class="va">species</span>, fill <span class="op">=</span> <span class="va">species</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_void</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">'bottom'</span><span class="op">)</span></span>
<span></span>
<span><span class="va">base</span></span></code></pre></div>
<p><img src="WorkedExample_files/figure-html/create%20basemap-1.png" class="r-plt" alt="" width="700"></p>
</div>
<div class="section level3">
<h3 id="using-safehavens">using safeHavens<a class="anchor" aria-label="anchor" href="#using-safehavens"></a>
</h3>
<p>Now we will use the safeHavens functionality with our set-up
environment and data from GBIF.</p>
<div class="section level4">
<h4 id="create-species-ranges">Create species ranges<a class="anchor" aria-label="anchor" href="#create-species-ranges"></a>
</h4>
<p>We will showcase two methods of generating the species range
geometries, which are used by most of the packages functions. Both of
these rely on the <code>st_concave_hull</code> function from
<code>sf</code>. <code>st_concave_hull</code>, has a ratio parameter
which can control the elasticity of hulls, with the ratio = 1 creating a
convex hull (akin the <code>st_convex_hull</code> function, also in
<code>sf</code>), and ratio = 0.0, creating a true concave hull. Results
below a ratio of 0.4 look too narrowly reduced for both of these
species.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sppL</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/split.html" class="external-link">split</a></span><span class="op">(</span><span class="va">spp</span>, f <span class="op">=</span> <span class="va">spp</span><span class="op">$</span><span class="va">species</span><span class="op">)</span></span>
<span></span>
<span><span class="va">concavities</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">d</span>, <span class="va">rat</span><span class="op">)</span><span class="op">{</span></span>
<span></span>
<span>  <span class="va">species</span> <span class="op">&lt;-</span> <span class="va">x</span><span class="op">[[</span><span class="st">'species'</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span>
<span>  <span class="va">out</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_transform.html" class="external-link">st_transform</a></span><span class="op">(</span><span class="va">x</span>, <span class="fl">5070</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_unary.html" class="external-link">st_buffer</a></span><span class="op">(</span>dist <span class="op">=</span> <span class="va">d</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_combine.html" class="external-link">st_union</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_unary.html" class="external-link">st_concave_hull</a></span><span class="op">(</span>ratio <span class="op">=</span> <span class="va">rat</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://r-spatial.github.io/sf/reference/sf.html" class="external-link">st_sf</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>geometry <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span><span class="va">species</span>, .before <span class="op">=</span> <span class="va">geometry</span><span class="op">)</span></span>
<span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">spp_concave</span> <span class="op">&lt;-</span> <span class="va">sppL</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span><span class="op">~</span> <span class="fu">concavities</span><span class="op">(</span><span class="va">.x</span>, d <span class="op">=</span> <span class="fl">20000</span>, rat <span class="op">=</span> <span class="fl">0.4</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">spp_convex</span> <span class="op">&lt;-</span> <span class="va">sppL</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span><span class="op">~</span> <span class="fu">concavities</span><span class="op">(</span><span class="va">.x</span>, d <span class="op">=</span> <span class="fl">20000</span>, rat <span class="op">=</span> <span class="fl">1.0</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/rm.html" class="external-link">rm</a></span><span class="op">(</span><span class="va">concavities</span><span class="op">)</span></span></code></pre></div>
<p>Visualize the concave hulls.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">base</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">spp_concave</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">species</span><span class="op">)</span>, alpha <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">spp_concave</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span>,  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">species</span><span class="op">)</span>, alpha <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span> </span></code></pre></div>
<p><img src="WorkedExample_files/figure-html/plot%20concave%20hulls-1.png" class="r-plt" alt="" width="700"></p>
<p>Visualize the convex hulls.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">base</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">spp_convex</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>,  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">species</span><span class="op">)</span>, alpha <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">spp_convex</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">species</span><span class="op">)</span>, alpha <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span> </span></code></pre></div>
<p><img src="WorkedExample_files/figure-html/plot%20convex%20hulls-1.png" class="r-plt" alt="" width="700"></p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/rm.html" class="external-link">rm</a></span><span class="op">(</span><span class="va">spp_convex</span><span class="op">)</span></span></code></pre></div>
<p>For the sake of the example we will only use the concave ranges, with
ratio 0.4, going forward.</p>
</div>
</div>
<div class="section level3">
<h3 id="perform-sampling-for-the-species-ranges">Perform sampling for the species ranges<a class="anchor" aria-label="anchor" href="#perform-sampling-for-the-species-ranges"></a>
</h3>
<p>First we will perform equal area sampling with a relatively small
amount of points and repetitions.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">eas</span> <span class="op">&lt;-</span> <span class="va">spp_concave</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span><span class="op">~</span> <span class="fu"><a href="../reference/EqualAreaSample.html">EqualAreaSample</a></span><span class="op">(</span><span class="va">.x</span>, n <span class="op">=</span> <span class="fl">10</span>, pts <span class="op">=</span> <span class="fl">250</span>, planar_proj <span class="op">=</span> <span class="fl">5070</span>, reps <span class="op">=</span> <span class="fl">25</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">base</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">eas</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="st">'Geometry'</span><span class="op">]</span><span class="op">]</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">ID</span><span class="op">)</span><span class="op">)</span>, alpha <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span></span></code></pre></div>
<p><img src="WorkedExample_files/figure-html/perform%20sampling-1.png" class="r-plt" alt="" width="700"></p>
<p>The plot above shows only the results for <em>Vesper
multinervatus</em>.</p>
<p>Below we perform isolation by distance (IBD) based sampling.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># create an arbitrary template for example - best to do this over your real range of all species collections</span></span>
<span><span class="co"># so that it can be recycled across species. </span></span>
<span><span class="va">template</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/rast.html" class="external-link">rast</a></span><span class="op">(</span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/ext.html" class="external-link">ext</a></span><span class="op">(</span><span class="va">bb</span><span class="op">)</span>, crs <span class="op">=</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/crs.html" class="external-link">crs</a></span><span class="op">(</span><span class="va">spp</span><span class="op">)</span>, resolution <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.1</span>, <span class="fl">0.1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/values.html" class="external-link">values</a></span><span class="op">(</span><span class="va">template</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span></span>
<span><span class="co"># the species range now gets 'burned' into the raster template. </span></span>
<span><span class="va">spp_concave</span> <span class="op">&lt;-</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span><span class="va">spp_concave</span>, \<span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html" class="external-link">st_as_sf</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>Range <span class="op">=</span> <span class="fl">1</span>, .before <span class="op">=</span> <span class="va">geometry</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_transform.html" class="external-link">st_transform</a></span><span class="op">(</span><span class="fl">4326</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/rasterize.html" class="external-link">rasterize</a></span><span class="op">(</span><span class="va">template</span>, field <span class="op">=</span> <span class="st">'Range'</span><span class="op">)</span> </span>
<span><span class="op">}</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## the actual sampling happens here within `map`</span></span>
<span><span class="va">ibd_samples</span> <span class="op">&lt;-</span> <span class="va">spp_concave</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span><span class="op">~</span> <span class="fu"><a href="../reference/IBDBasedSample.html">IBDBasedSample</a></span><span class="op">(</span><span class="va">.x</span>, n <span class="op">=</span> <span class="fl">10</span>, fixedClusters <span class="op">=</span> <span class="cn">FALSE</span>, template <span class="op">=</span> <span class="va">template</span>, planar_proj <span class="op">=</span> <span class="fl">5070</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">base</span> <span class="op">+</span> <span class="co">## visualize for a single taxon. </span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">ibd_samples</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="st">'Geometry'</span><span class="op">]</span><span class="op">]</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">ID</span><span class="op">)</span><span class="op">)</span>, alpha <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span></span></code></pre></div>
<p><img src="WorkedExample_files/figure-html/ibd%20sampling-1.png" class="r-plt" alt="" width="700"></p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/rm.html" class="external-link">rm</a></span><span class="op">(</span><span class="va">spp_concave</span><span class="op">)</span></span></code></pre></div>
<p>The above plot for the isolation-by-distance sampling shows the
individual sample areas for <em>Bouteloua warnockii</em>.</p>
<div class="section level4">
<h4 id="prioritize-sample-areas">prioritize sample areas<a class="anchor" aria-label="anchor" href="#prioritize-sample-areas"></a>
</h4>
<p>In addition to creating spatial geometries that can be used to guide
sampling efforts, <code>safeHavens</code> can also help provide
<em>visualize</em> guidance on general areas where germplasm can be
sampled from to try and maximize distance between the samples. Please
note that while <code>safeHavens</code> can offer <em>suggestions</em>
of where to sample, and <em>where</em> should be prioritized these
suggestions may not align with reality - so consider these rules of
thumbs! I have made, a couple hundred large native seed collections, and
coordinated a couple hundred more, for many years - and argue that
beggers cannot be choosers. Hence basing deliverable metrics purely
around data like this can be difficult - some degree of reporting
autonomy must be maintained.</p>
<p>The function <code>PrioritizeSample</code> offers two levels of
prioritization. The more coarse level will suggest a relative order that
the sample areas should be sampled in, from 1:n; the function seeks to
minimize the variance ( a related measure) between each sample as more
samples are collected. In effect it tries to stratify the sampling
across the species range. The second part of the function is almost a
‘heamap’ which can be used to show concentric rings around the
geographic center of each sample unit. Keeping the number of rings low
allows for some pragmatic communication of more desirable/less desirable
portions of the range to <em>ideally</em> collect in.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ibd_samples_priority</span> <span class="op">&lt;-</span> <span class="va">ibd_samples</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span><span class="op">~</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_transform.html" class="external-link">st_transform</a></span><span class="op">(</span><span class="va">.x</span><span class="op">$</span><span class="va">Geometry</span>, <span class="fl">5070</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span><span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="../reference/PrioritizeSample.html">PrioritizeSample</a></span><span class="op">(</span><span class="va">.x</span>, n_breaks <span class="op">=</span> <span class="fl">3</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">base</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">ibd_samples_priority</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="st">'Geometry'</span><span class="op">]</span><span class="op">]</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">Level</span><span class="op">)</span><span class="op">)</span>, alpha <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span></span></code></pre></div>
<p><img src="WorkedExample_files/figure-html/prioritize%20sample%20areas-1.png" class="r-plt" alt="" width="700"></p>
<p>The map above shows a possible general order to guide the
prioritization of individual sample areas, and simplified visuals of
where within sample areas to attempt to target.</p>
</div>
<div class="section level4">
<h4 id="wrapping-up">wrapping up<a class="anchor" aria-label="anchor" href="#wrapping-up"></a>
</h4>
<p>Upon completion of using <code>safeHavens</code> results should be
written to individual geopackages for long term storage. A strong
benefit of a geopackage is it’s ability to hold multiple geometry types
(polygons, points, rasters, etc.), which can sometimes be lost when they
are kept in separate directories.</p>
<p>Here we show how we would write out data for a range of species.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## create a directory to hold the outputs</span></span>
<span><span class="va">p2Collections</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="st">'~'</span>, <span class="st">'Documents'</span>, <span class="st">'WorkedExample_Output'</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/files2.html" class="external-link">dir.create</a></span><span class="op">(</span><span class="va">p2Collections</span>, showWarnings <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## we will only save the template raster once since it is recycled across taxa. </span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/files2.html" class="external-link">dir.create</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">p2Collections</span>, <span class="st">'IBD_raster_template'</span><span class="op">)</span>, showWarnings <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/writeRaster.html" class="external-link">writeRaster</a></span><span class="op">(</span><span class="va">template</span>, </span>
<span>  filename <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">p2Collections</span>, <span class="st">'IBD_raster_template'</span>, <span class="st">'IBD_template.tif'</span><span class="op">)</span>, overwrite <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## save each species as a unique geopackage. </span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">sppL</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span></span>
<span>  <span class="va">fp</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">p2Collections</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="st">' '</span>, <span class="st">'_'</span>, <span class="va">sppL</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">species</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span>, <span class="st">'.gpkg'</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co">### GBIF occurrence points</span></span>
<span>  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_write.html" class="external-link">st_write</a></span><span class="op">(</span><span class="va">sppL</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span>, dsn <span class="op">=</span> <span class="va">fp</span>, layer <span class="op">=</span>  <span class="st">'occurrence_points'</span>, quiet <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co">### results of equal area sampling  </span></span>
<span>  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_write.html" class="external-link">st_write</a></span><span class="op">(</span><span class="va">eas</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">Geometry</span>,  dsn <span class="op">=</span> <span class="va">fp</span>, layer <span class="op">=</span>  <span class="st">'equal_area_samples'</span>, quiet <span class="op">=</span> <span class="cn">TRUE</span>, append <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co">### ibd based sample (note can be reconstruced from the hulls of ibd samples priority)</span></span>
<span>  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_write.html" class="external-link">st_write</a></span><span class="op">(</span><span class="va">ibd_samples</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">Geometry</span>, dsn <span class="op">=</span> <span class="va">fp</span>, layer <span class="op">=</span>  <span class="st">'ibd_samples'</span>, quiet <span class="op">=</span> <span class="cn">TRUE</span>, append <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co">### prioritized information for the IBD samples. </span></span>
<span>  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_write.html" class="external-link">st_write</a></span><span class="op">(</span><span class="va">ibd_samples_priority</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">Geometry</span>, dsn <span class="op">=</span> <span class="va">fp</span>, layer <span class="op">=</span>  <span class="st">'ibd_sampling_priority'</span>, quiet <span class="op">=</span> <span class="cn">TRUE</span>, append <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/format.html" class="external-link">format</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/object.size.html" class="external-link">object.size</a></span><span class="op">(</span><span class="va">fp</span><span class="op">)</span>, standard <span class="op">=</span> <span class="st">"IEC"</span>, units <span class="op">=</span> <span class="st">"MiB"</span>, digits <span class="op">=</span> <span class="fl">4</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<pre><code>Warning in rm(spp, sppL, eas, ibd_samples, ibd_samples_priority, base,
template, : object 'p2Collections' not found
Warning in rm(spp, sppL, eas, ibd_samples, ibd_samples_priority, base,
template, : object 'fp' not found
Warning in rm(spp, sppL, eas, ibd_samples, ibd_samples_priority, base,
template, : object 'i' not found</code></pre>
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Reed Benkendorf.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
